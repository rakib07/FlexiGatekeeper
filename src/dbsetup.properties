# To change this license header, choose License Headers in Project Properties.
# To change this template file, choose Tools | Templates
# and open the template in the editor.
#select db
db.create=CREATE DATABASE IF NOT EXISTS {0}
db.use = use {0}

#create tables
db.table.services = CREATE TABLE IF NOT EXISTS `services` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT,`title` varchar(200) NOT NULL,PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;   
db.table.users = CREATE TABLE IF NOT EXISTS `users` (`user_id` int(11) unsigned NOT NULL,`reference_username` varchar(200) NOT NULL,`reference_password` varchar(80) NOT NULL,`created_on` int(11) unsigned NOT NULL,`modified_on` int(11) unsigned NOT NULL,PRIMARY KEY (`user_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.subscribers = CREATE TABLE IF NOT EXISTS `subscribers` (`user_id` int(11) unsigned NOT NULL,`registration_date` int(11) unsigned NOT NULL,`expired_date` int(11) unsigned NOT NULL,`max_members` int(11) unsigned NOT NULL,`ip_address` varchar(200) NOT NULL,PRIMARY KEY (`user_id`),KEY `fk_subscribers1_idx` (`user_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.subscribers_members = CREATE TABLE IF NOT EXISTS `subscribers_members` (`subscriber_user_id` int(11) unsigned NOT NULL,`member_user_id` int(11) unsigned NOT NULL,UNIQUE KEY `uk_subscribers_members` (`subscriber_user_id`,`member_user_id`),KEY `fk_subscribers_members1_idx` (`subscriber_user_id`),KEY `fk_subscribers_members2_idx` (`member_user_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.subscribers_services = CREATE TABLE IF NOT EXISTS `subscribers_services` (`subscriber_user_id` int(11) unsigned NOT NULL,`service_id` int(11) unsigned NOT NULL,`api_key` varchar(200) NOT NULL,`registration_date` int(11) unsigned NOT NULL,`expired_date` int(11) unsigned NOT NULL,UNIQUE KEY `uk_subscribers_services` (`subscriber_user_id`,`service_id`),KEY `fk_subscribers_services1_idx` (`subscriber_user_id`),KEY `fk_subscribers_services2_idx` (`service_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

#create relations
db.rel.subscribers = ALTER TABLE `subscribers` ADD CONSTRAINT `fk_subscribers1` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`) ON DELETE CASCADE ON UPDATE CASCADE;
db.rel.subscribers_members = ALTER TABLE `subscribers_members` ADD CONSTRAINT `fk_subscribers_members1` FOREIGN KEY (`subscriber_user_id`) REFERENCES `users` (`user_id`) ON DELETE CASCADE ON UPDATE CASCADE, ADD CONSTRAINT `fk_subscribers_members2` FOREIGN KEY (`member_user_id`) REFERENCES `users` (`user_id`) ON DELETE CASCADE ON UPDATE CASCADE;
db.rel.subscribers_services = ALTER TABLE `subscribers_services` ADD CONSTRAINT `fk_subscribers_services1` FOREIGN KEY (`subscriber_user_id`) REFERENCES `users` (`user_id`) ON DELETE CASCADE ON UPDATE CASCADE, ADD CONSTRAINT `fk_subscribers_services2` FOREIGN KEY (`service_id`) REFERENCES `services` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

#insert default data
db.defaultData.services = INSERT INTO `services` (`id`, `title`) VALUES (1, 'BKash Send Money'), (2, 'Topup Service');
db.defaultData.users = INSERT INTO `users` (`user_id`, `reference_username`, `reference_password`, `created_on`, `modified_on`) VALUES (1, 'ru1', 'rp1', 1392232479, 1392232479), (2, 'ru2', 'rp2', 1392232479, 1392232479);
db.defaultData.subscribers = INSERT INTO `subscribers` (`user_id`, `registration_date`, `expired_date`, `max_members`, `ip_address`) VALUES (1, 1392232479, 1392232479, 10, '192.168.1.1');
db.defaultData.subscribers_members = INSERT INTO `subscribers_members` (`subscriber_user_id`, `member_user_id`) VALUES (1, 1), (2, 2);
db.defaultData.subscribers_services = INSERT INTO `subscribers_services` (`subscriber_user_id`, `service_id`, `api_key`, `registration_date`, `expired_date`) VALUES (1, 1, 'key1', 1392232479, 1392232479), (1, 2, 'key2', 1392232479, 1392232479);
